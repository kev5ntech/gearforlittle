---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  publishDate?: string;
  author?: string;
}

const {
  title,
  description = 'Honest baby gear reviews from an engineer dad who buys and tests everything. Find the best strollers, car seats, cribs, monitors, and more.',
  image = '/og-default.png',
  type = 'website',
  publishDate,
  author = 'GearForLittle',
} = Astro.props;

const siteURL = Astro.site ?? new URL(Astro.url.origin);
const canonical = new URL(Astro.url.pathname, siteURL);
const ogImage = image.startsWith('http') ? image : new URL(image, siteURL).toString();

const pageTitle =
  title === 'Home'
    ? 'GearForLittle — Honest Baby Gear Reviews'
    : `${title} — GearForLittle`;

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'GearForLittle',
  url: siteURL.toString(),
  description,
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${siteURL}search?q={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
};

const categories = [
  { label: 'Strollers',    href: '/strollers'   },
  { label: 'Car Seats',    href: '/car-seats'   },
  { label: 'Cribs & Sleep',href: '/cribs'       },
  { label: 'Baby Monitors',href: '/monitors'    },
  { label: 'Carriers',     href: '/carriers'    },
  { label: 'Feeding',      href: '/feeding'     },
  { label: 'Diaper Bags',  href: '/diaper-bags' },
  { label: 'Travel Gear',  href: '/travel'      },
];
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary SEO -->
    <title>{pageTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />

    <!-- Open Graph -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content="GearForLittle" />
    {publishDate && <meta property="article:published_time" content={publishDate} />}
    {author && type === 'article' && <meta property="article:author" content={author} />}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- Schema.org: WebSite -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify(websiteSchema)} />

    <!--
      Google Analytics — replace G-XXXXXXXXXX with your GA4 measurement ID
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
      </script>
    -->
  </head>

  <body class="min-h-screen flex flex-col bg-white text-neutral-800 font-sans antialiased">

    <!-- ================================================================
         HEADER
         ================================================================ -->
    <header
      id="site-header"
      class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-neutral-200 transition-shadow duration-200"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">

          <!-- Logo -->
          <a
            href="/"
            class="flex items-center gap-2 text-primary-600 hover:text-primary-700 no-underline transition-colors flex-shrink-0"
            aria-label="GearForLittle home"
          >
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" aria-hidden="true">
              <circle cx="14" cy="14" r="14" fill="currentColor" opacity="0.15"/>
              <circle cx="14" cy="14" r="9" fill="currentColor"/>
              <path d="M10 14.5c0-2.2 1.8-4 4-4s4 1.8 4 4-1.8 4-4 4-4-1.8-4-4z" fill="white"/>
            </svg>
            <span class="text-xl font-bold tracking-tight">GearForLittle</span>
          </a>

          <!-- Desktop nav -->
          <nav class="hidden md:flex items-center gap-1" aria-label="Main navigation">

            <!-- Categories dropdown -->
            <div class="relative" id="categories-menu">
              <button
                id="categories-btn"
                aria-haspopup="true"
                aria-expanded="false"
                class="flex items-center gap-1 px-3 py-2 text-sm font-medium text-neutral-600 hover:text-primary-600 rounded-lg hover:bg-neutral-50 transition-colors"
              >
                Categories
                <svg class="w-4 h-4 transition-transform duration-200" id="categories-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>

              <div
                id="categories-dropdown"
                class="hidden absolute top-full left-0 mt-1 w-52 bg-white rounded-xl shadow-lg border border-neutral-200 py-2 z-50"
                role="menu"
              >
                {categories.map((cat) => (
                  <a
                    href={cat.href}
                    class="block px-4 py-2 text-sm text-neutral-700 hover:bg-primary-50 hover:text-primary-700 no-underline transition-colors"
                    role="menuitem"
                  >
                    {cat.label}
                  </a>
                ))}
                <div class="border-t border-neutral-100 mt-2 pt-2">
                  <a
                    href="/blog"
                    class="block px-4 py-2 text-sm font-medium text-primary-600 hover:bg-primary-50 no-underline transition-colors"
                    role="menuitem"
                  >
                    All Reviews →
                  </a>
                </div>
              </div>
            </div>

            <a href="/about" class="px-3 py-2 text-sm font-medium text-neutral-600 hover:text-primary-600 rounded-lg hover:bg-neutral-50 transition-colors no-underline">About</a>
            <a href="/how-we-test" class="px-3 py-2 text-sm font-medium text-neutral-600 hover:text-primary-600 rounded-lg hover:bg-neutral-50 transition-colors no-underline">How We Test</a>

            <!-- Search icon -->
            <button
              aria-label="Search"
              class="p-2 text-neutral-500 hover:text-primary-600 hover:bg-neutral-50 rounded-lg transition-colors ml-1"
            >
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><path stroke-linecap="round" d="m21 21-4.35-4.35"/>
              </svg>
            </button>

          </nav>

          <!-- Mobile: hamburger -->
          <button
            id="mobile-toggle"
            aria-label="Open menu"
            aria-expanded="false"
            aria-controls="mobile-nav"
            class="md:hidden p-2 text-neutral-600 hover:text-primary-600 rounded-lg hover:bg-neutral-50 transition-colors"
          >
            <svg id="hamburger-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            <svg id="close-icon" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
            </svg>
          </button>

        </div>
      </div>

      <!-- Mobile nav panel -->
      <div
        id="mobile-nav"
        class="hidden md:hidden border-t border-neutral-200 bg-white"
        role="dialog"
        aria-label="Mobile navigation"
      >
        <div class="max-w-7xl mx-auto px-4 py-4 space-y-1">
          <p class="text-xs font-semibold text-neutral-400 uppercase tracking-wider px-3 py-1">Categories</p>
          {categories.map((cat) => (
            <a href={cat.href} class="block px-3 py-2 text-sm text-neutral-700 hover:bg-primary-50 hover:text-primary-700 rounded-lg no-underline transition-colors">
              {cat.label}
            </a>
          ))}
          <div class="border-t border-neutral-100 pt-3 mt-3 space-y-1">
            <a href="/about" class="block px-3 py-2 text-sm font-medium text-neutral-700 hover:bg-neutral-50 rounded-lg no-underline">About</a>
            <a href="/how-we-test" class="block px-3 py-2 text-sm font-medium text-neutral-700 hover:bg-neutral-50 rounded-lg no-underline">How We Test</a>
          </div>
        </div>
      </div>
    </header>

    <!-- ================================================================
         MAIN CONTENT
         ================================================================ -->
    <main id="main-content" class="flex-1">
      <slot />
    </main>

    <!-- ================================================================
         FOOTER
         ================================================================ -->
    <footer class="bg-secondary-900 text-neutral-300 mt-auto">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-14 pb-8">

        <!-- Top grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 mb-12">

          <!-- Brand column -->
          <div>
            <a href="/" class="inline-flex items-center gap-2 text-white no-underline mb-4">
              <svg width="24" height="24" viewBox="0 0 28 28" fill="none">
                <circle cx="14" cy="14" r="14" fill="#0d9488" opacity="0.3"/>
                <circle cx="14" cy="14" r="9" fill="#0d9488"/>
                <path d="M10 14.5c0-2.2 1.8-4 4-4s4 1.8 4 4-1.8 4-4 4-4-1.8-4-4z" fill="white"/>
              </svg>
              <span class="font-bold text-lg">GearForLittle</span>
            </a>
            <p class="text-sm leading-relaxed text-neutral-400 mb-4">
              Honest baby gear reviews from an engineer dad who buys, assembles, and tests everything before writing a word.
            </p>
            <p class="text-sm font-medium text-primary-400 italic">
              "Built by a dad who actually tests this stuff."
            </p>
          </div>

          <!-- Quick links -->
          <div>
            <h3 class="text-white font-semibold text-sm uppercase tracking-wider mb-4">Quick Links</h3>
            <ul class="space-y-2 text-sm">
              <li><a href="/blog" class="text-neutral-400 hover:text-white no-underline transition-colors">All Reviews</a></li>
              <li><a href="/comparisons" class="text-neutral-400 hover:text-white no-underline transition-colors">Comparisons</a></li>
              <li><a href="/registry" class="text-neutral-400 hover:text-white no-underline transition-colors">Registry Guide</a></li>
              <li><a href="/about" class="text-neutral-400 hover:text-white no-underline transition-colors">About</a></li>
              <li><a href="/how-we-test" class="text-neutral-400 hover:text-white no-underline transition-colors">How We Test</a></li>
            </ul>
          </div>

          <!-- Categories -->
          <div>
            <h3 class="text-white font-semibold text-sm uppercase tracking-wider mb-4">Categories</h3>
            <ul class="space-y-2 text-sm">
              {categories.slice(0, 6).map((cat) => (
                <li>
                  <a href={cat.href} class="text-neutral-400 hover:text-white no-underline transition-colors">
                    {cat.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>

        </div>

        <!-- Affiliate disclosure -->
        <div class="border-t border-neutral-800 pt-8 mb-6">
          <p class="text-xs text-neutral-500 leading-relaxed max-w-3xl">
            <strong class="text-neutral-400">Affiliate Disclosure:</strong> GearForLittle participates in affiliate programs including Amazon Associates. When you purchase through links on this site, we may earn a small commission at no additional cost to you. This never influences our ratings or recommendations — we only recommend products we'd buy for our own kids.
          </p>
        </div>

        <!-- Bottom bar -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 text-xs text-neutral-500">
          <p>&copy; {new Date().getFullYear()} GearForLittle. All rights reserved.</p>
          <nav class="flex flex-wrap gap-4" aria-label="Legal navigation">
            <a href="/about" class="hover:text-neutral-300 no-underline transition-colors">About</a>
            <a href="/how-we-test" class="hover:text-neutral-300 no-underline transition-colors">How We Test</a>
            <a href="/disclosure" class="hover:text-neutral-300 no-underline transition-colors">Affiliate Disclosure</a>
            <a href="/privacy" class="hover:text-neutral-300 no-underline transition-colors">Privacy Policy</a>
          </nav>
        </div>

      </div>
    </footer>

    <!-- ================================================================
         SCRIPTS
         ================================================================ -->
    <script>
      // --- Header shadow on scroll ---
      const header = document.getElementById('site-header');
      const onScroll = () => {
        if (header) {
          header.classList.toggle('shadow-md', window.scrollY > 8);
        }
      };
      window.addEventListener('scroll', onScroll, { passive: true });

      // --- Categories dropdown ---
      const catBtn = document.getElementById('categories-btn');
      const catMenu = document.getElementById('categories-menu');
      const catDropdown = document.getElementById('categories-dropdown');
      const catChevron = document.getElementById('categories-chevron');

      catBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = !catDropdown?.classList.contains('hidden');
        catDropdown?.classList.toggle('hidden', isOpen);
        catChevron?.classList.toggle('rotate-180', !isOpen);
        catBtn.setAttribute('aria-expanded', String(!isOpen));
      });

      document.addEventListener('click', (e) => {
        if (catMenu && !catMenu.contains(e.target as Node)) {
          catDropdown?.classList.add('hidden');
          catChevron?.classList.remove('rotate-180');
          catBtn?.setAttribute('aria-expanded', 'false');
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          catDropdown?.classList.add('hidden');
          catChevron?.classList.remove('rotate-180');
          catBtn?.setAttribute('aria-expanded', 'false');
        }
      });

      // --- Mobile menu toggle ---
      const mobileToggle = document.getElementById('mobile-toggle');
      const mobileNav = document.getElementById('mobile-nav');
      const hamburgerIcon = document.getElementById('hamburger-icon');
      const closeIcon = document.getElementById('close-icon');

      mobileToggle?.addEventListener('click', () => {
        const isOpen = !mobileNav?.classList.contains('hidden');
        mobileNav?.classList.toggle('hidden', isOpen);
        hamburgerIcon?.classList.toggle('hidden', !isOpen);
        closeIcon?.classList.toggle('hidden', isOpen);
        mobileToggle.setAttribute('aria-expanded', String(!isOpen));
      });
    </script>

  </body>
</html>
